<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bda.plone.payment">

<head>
  <metal:top fill-slot="top_slot">
    <tal:border define="dummy python:request.set('disable_border', True)" />
  </metal:top>
</head>

<body>

<metal:main fill-slot="main">
  <tal:main-macro metal:define-macro="main">
    
    <tal:block define="order_data view/verify;
                      verified python:order_data['verified'];
                      ticket python:order_data['ticket'];
                      tickets python: 'tickets' in context.absolute_url();
                      header_image python: view.get_header_image(tickets)">
      
      <tal:verified condition="verified">
        
        <div id="cart-page-header" tal:attributes="style python: 'background-image:url(%s)' %(header_image)">
          <h1 class="documentFirstHeading"
              i18n:translate="payment_success">Payment Success</h1>
        </div>
        
        <div class="results-wrapper">
          <div class="wrapper-result-page">

            <div>
              <p><span i18n:translate="">Thank you very much for your order!</span></p>

              <p tal:condition="not:tickets">
                <span i18n:translate="">Deze wordt binnen 3-5 dagen via TPG Post verzonden.</span><br>
                <span i18n:translate="">Within minutes you will receive a confirmation of your order by email.</span><br>
                <span i18n:translate="">Please check your spam and junk email folder if you have not received the email.</span>
              </p>
            </div>

             <a href="" tal:attributes="href python: order_data['download_link']" 
              class="payment_button" tal:condition="tickets"><i class="fa fa-download"></i>  Download e-ticket(s)</a>


            <div class="ticket-information" tal:condition="python: tickets and order_data['ordernumber'] != ''">
              <p i18n:translate="order_number_text" id="ordernumber_order_text">
                <span i18n:translate="">Your order (order number:</span> <strong tal:content="python: order_data['ordernumber']"></strong>) <span i18n:translate="">was completed successfully.</span>
              </p>
              <p id="spam_order_message">
                <span i18n:translate="">Within minutes you will receive an email with the order confirmation and your e-ticket(s) in the attachment. P</span>
                <span i18n:translate="">Please check your spam and junk email folder if you have not received the email.</span>
              </p>
            </div>
          </div>
          <div class="download-btn">
            
          </div>
        </div>

        <div id="order-data" style="display:none">
          <p id="order_id" tal:content="python: order_data['order_id']"></p>
          <p id="order_total" tal:content="python: order_data['total']"></p>
          <p id="order_shipping" tal:content="python: order_data['shipping']"></p>
          <p id="order_currency" tal:content="python: order_data['currency']"></p>
          <p id="order_tax" tal:content="python: order_data['tax']"></p>
          <p id="order_type" tal:condition="ticket">E-Ticket</p>
          <p id="order_type" tal:condition="not:ticket">Product</p>
          <p id="order_bookings" tal:attributes="data-bookings python:order_data['bookings']"></p>
        </div>
        
        <tal:send_ga>
          <script>

            $(document).ready(function() {
              window.dataLayer = window.dataLayer || [];
              var order_id = $('#order_id').html();
              var order_total = $('#order_total').html();
              var order_shipping = $('#order_shipping').html();
              var order_currency = $('#order_currency').html();
              var order_tax = $('#order_tax').html();
              var title = $("title").html();
              var order_type = $('#order_type').html();

              var order_bookings = $.parseJSON($('#order_bookings').attr('data-bookings'));

              dataLayer.push({
                'event': 'transactionComplete',
                'transactionId': order_id,
                'transactionTotal': parseFloat(order_total),
                'transactionTax': parseFloat(order_tax),
                'transactionShipping': parseFloat(order_shipping),
                'transactionProducts': order_bookings
              });
            });
            
          </script>
        </tal:send_ga>

      </tal:verified>
      
      <tal:verification_failed condition="not:verified">
        
        <div id="cart-page-header" tal:attributes="style python: 'background-image:url(%s)' %(header_image)">
          <h1 class="documentFirstHeading"
            i18n:translate="payment_error">Something went wrong</h1>
        </div>
        
        <div class="results-wrapper">
          <div class="wrapper-result-page">
            <p>
              <span i18n:translate="six_payment_verification_failed" tal:condition="not:tickets">
                Er is iets mis gegaan. De betalingsverificatie is mislukt. Probeer het nog eens of neem contact met ons op als je denkt dat de fout bij ons ligt.
              </span>
              <span i18n:translate="six_payment_verification_failed" tal:condition="tickets">
                Oops, something went wrong. Your tickets have not been payed because the payment verification failed. We're sorry for the inconvenience. Please try again to order your tickets, or contact us if you think the problem is on our side:
              </span>
            </p>
            <p>
              <a href="mailto:shopmaster@example.com"
              style="text-decoration:underline;"
               tal:attributes="href string:mailto:${view/shopmaster_mail}"
               i18n:translate="">Contact us</a>
             </p>
          
          </div>
        </div>
      
      </tal:verification_failed>
    
    </tal:block>
    
  </tal:main-macro>
</metal:main>

</body>
</html>


