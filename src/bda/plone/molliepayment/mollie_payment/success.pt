<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bda.plone.payment">

<head>
  <metal:top fill-slot="top_slot">
    <tal:border define="dummy python:request.set('disable_border', True)" />
  </metal:top>
</head>

<body>

<metal:main fill-slot="main">
  <tal:main-macro metal:define-macro="main">
    
    <tal:block define="order_data view/verify;
                      verified python:order_data['verified'];
                      ticket python:order_data['ticket'];
                      tickets python: 'tickets' in context.absolute_url();
                      header_image python: view.get_header_image(tickets)">
      
      <tal:verified condition="verified">
        
        <div id="cart-page-header" tal:attributes="style python: 'background-image:url(%s)' %(header_image)">
          <h1 class="documentFirstHeading"
              i18n:translate="payment_success">Payment Success</h1>
        </div>
        
        <div class="results-wrapper">
          <div class="wrapper-result-page">

            <div>
              <p><span>Hartelijk bedankt voor uw bestelling!</span></p>
              <p tal:condition="not:tickets">
                Deze wordt binnen 3-5 dagen via TPG Post verzonden.<br>
                Binnen enkele minuten ontvangt u een bevestiging van uw bestelling per mail.<br>
                Controleer uw spam en ongewenste e-mail map wanneer u de e-mail niet ontvangen heeft.
              </p>
            </div>

             <a href="" tal:attributes="href python: order_data['download_link']" 
              class="payment_button" tal:condition="tickets"><i class="fa fa-download"></i>  Download e-ticket(s)</a>

            <div class="ticket-information" tal:condition="python: tickets and order_data['ordernumber'] != ''">
              <p i18n:translate="order_number_text" id="ordernumber_order_text">
                Uw boeking (ordernummer: <strong tal:content="python: order_data['ordernumber']"></strong>) is met succes afgerond.
              </p>
              <p i18n:translate="spam_order_message" id="spam_order_message">
                Binnen enkele minuten ontvangt u de boekingsbevestiging met een link naar uw e-tickets.
                Controleer uw spam en ongewenste e-mail map wanneer u de e-mail niet ontvangen heeft.
              </p>
            </div>
          </div>
          <div class="download-btn">
            
          </div>
        </div>

        <div id="order-data" style="display:none">
          <p id="order_id" tal:content="python: order_data['order_id']"></p>
          <p id="order_total" tal:content="python: order_data['total']"></p>
          <p id="order_shipping" tal:content="python: order_data['shipping']"></p>
          <p id="order_currency" tal:content="python: order_data['currency']"></p>
          <p id="order_tax" tal:content="python: order_data['tax']"></p>
          <p id="order_type" tal:condition="ticket">E-Ticket</p>
          <p id="order_type" tal:condition="not:ticket">Product</p>
          <p id="order_bookings" tal:attributes="data-bookings python:order_data['bookings']"></p>
        </div>
        
        <tal:send_ga tal:condition="python: order_data['already_sent'] == False">
          <script>

            $(document).ready(function() {
              var order_id = $('#order_id').html();
              var order_total = $('#order_total').html();
              var order_shipping = $('#order_shipping').html();
              var order_currency = $('#order_currency').html();
              var order_tax = $('#order_tax').html();
              var title = $("title").html();
              var order_type = $('#order_type').html();

              var order_bookings = $.parseJSON($('#order_bookings').attr('data-bookings'));

              dataLayer.push({
                'event': 'transactionComplete',
                'transactionId': order_id,
                'transactionTotal': order_total,
                'transactionTax': order_tax,
                'transactionShipping': order_shipping,
                'transactionProducts': order_bookings
              });
            });
            
          </script>
        </tal:send_ga>

      </tal:verified>
      
      <tal:verification_failed condition="not:verified">
        
        <div id="cart-page-header" tal:attributes="style python: 'background-image:url(%s)' %(header_image)">
          <h1 class="documentFirstHeading"
            i18n:translate="payment_error">Payment Error</h1>
        </div>
        
        <div class="results-wrapper">
          <div class="wrapper-result-page">
            <p><span i18n:translate="six_payment_verification_failed">
              Something nasty is going on. Payment verification failed.
              If you think the failure remains on our side, please contact
            </span></p>
            <p>
              <a href="mailto:shopmaster@example.com"
              style="text-decoration:underline;"
               tal:attributes="href string:mailto:${view/shopmaster_mail}"
               >Contact <span i18n:translate="us">us</span></a>
             </p>
          
          </div>
        </div>
      
      </tal:verification_failed>
    
    </tal:block>
    
  </tal:main-macro>
</metal:main>

</body>
</html>


