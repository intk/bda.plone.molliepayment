<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bda.plone.payment">

<head>
  <metal:top fill-slot="top_slot">
    <tal:border define="dummy python:request.set('disable_border', True)" />
  </metal:top>
</head>

<body>

<metal:main fill-slot="main">
  <tal:main-macro metal:define-macro="main">
    
    <tal:block define="order_data view/verify;
                      verified python:order_data['verified']">
      
      <tal:verified condition="verified">
      
        <h1 class="documentFirstHeading"
            i18n:translate="payment_success">Payment Success</h1>
        
        <div class="results-wrapper">
          <div class="wrapper-result-page">
            <p i18n:translate="six_payment_success_text">
              Your Order has been completed successful.
            </p>
            <a href=""
             class="payment_button"
             tal:attributes="href context/absolute_url"
             i18n:translate="payment_done">continue</a>
          </div>
        </div>

        <div id="order-data" style="display:none">
          <p id="order_id" tal:content="python: order_data['order_id']"></p>
          <p id="order_total" tal:content="python: order_data['total']"></p>
          <p id="order_shipping" tal:content="python: order_data['shipping']"></p>
          <p id="order_currency" tal:content="python: order_data['currency']"></p>
          <p id="order_tax" tal:content="python: order_data['tax']"></p>
        </div>
        
        <script>

          $(document).ready(function() {
            var order_id = $('#order_id').html();
            var order_total = $('#order_total').html();
            var order_shipping = $('#order_shipping').html();
            var order_currency = $('#order_currency').html();
            var order_tax = $('#order_tax').html();
            var title = $("title").html();

            dataLayer.push({
              'event': 'transactionComplete',
              'transactionId': order_id,
              'transactionTotal': order_total,
              'transactionTax': order_tax,
              'transactionShipping': order_shipping,
              'transactionProducts': [{
                  'sku': order_id,
                  'name': title,
                  'price': order_total,
                  'quantity': 1
              }]
            });
          }

          /*dataLayer.push({
            'event': 'transactionComplete',
            'transactionId': '1234',
            'transactionAffiliation': 'Acme Clothing',
            'transactionTotal': 38.26,
            'transactionTax': 1.29,
            'transactionShipping': 5,
            'transactionProducts': [{
                'sku': 'DD44',
                'name': 'T-Shirt',
                'category': 'Apparel',
                'price': 11.99,
                'quantity': 1
            },{
                'sku': 'AA1243544',
                'name': 'Socks',
                'category': 'Apparel',
                'price': 9.99,
                'quantity': 2
            }]
          });*/


          /*$(document).ready(function() {
            var order_id = $('#order_id').html();
            var order_total = $('#order_total').html();
            var order_shipping = $('#order_shipping').html();
            var order_currency = $('#order_currency').html();
            var order_tax = $('#order_tax').html();

            dataLayer.push({
              'ecommerce': {
                'purchase': {
                  'actionField': {
                    'id': order_id,
                    'revenue': order_total,
                    'tax': order_tax,
                    'shipping': order_shipping
                  },
                  'products': [
                    {
                      'id': order_id,
                      'price': order_total,
                      'quantity': 1
                    }
                  ]
                }
              }

            });
          });*/
          
        </script>

      </tal:verified>
      
      <tal:verification_failed condition="not:verified">
      
        <h1 class="documentFirstHeading"
            i18n:translate="payment_error">Payment Error</h1>
        
        
        <div class="results-wrapper">
          <div class="wrapper-result-page">
            <p><span i18n:translate="six_payment_verification_failed">
              Something nasty is going on. Payment verification failed.
              If you think the failure remains on our side, please contact
            </span></p>
            <p>
              <a href="mailto:shopmaster@example.com"
              style="text-decoration:underline;"
               tal:attributes="href string:mailto:${view/shopmaster_mail}"
               >Contact <span i18n:translate="us">us</span></a>
             </p>
          
          </div>
        </div>
      
      </tal:verification_failed>
    
    </tal:block>
    
  </tal:main-macro>
</metal:main>



</body>
</html>