

<div id="cart"
     i18n:domain="bda.plone.cart"
     tal:define="currency view/currency;
                 order_id python: request.get('order_id', 0);">

  <style>
    html, body {
      height: 99%;
    }

    .ticket-item.is_event #ticketBarcode > div:last-child {
      margin-left: 0px !important;
    }

    .ticket-item:not(.is_event) #ticketBarcode > div:last-child {
      margin-left: -19px !important;
    }


    #ticket-footer {
      
    }

    .ticket-item:not(:last-child) {
      margin-bottom: 0px;
    }

    body.template-etickets .ticket-item:not(:last-child) {
      padding-bottom: 32px !important;
    }

    .ticket-item.is_event #ticketBarcode {
      margin:0 100px;
    }

    .ticket-item:not(.is_event) #ticketBarcode {
      margin:0;
    }

    .ajax-message, footer, .title-container, .cd-nav-trigger, #portal-logo, .intro-header, #ajax-spinner {
      display: none !important;
    }

    .page-container {
      padding-top: 0px !important;
    }

    #ticketBarcode {
      padding-left: 20px !important;
    }

    article#content {
      margin-bottom: 0px !important;
    }

    a {
      color: #666666 !important;
      text-decoration: underline !important;
    }

  </style>

  <tal:cart
    tal:define="orders python: view.get_etickets(order_id);
                total_tickets python: orders['total_tickets'];
                timeslot_title python: orders.get('timeslot_title', '');
                event_date python: orders.get('event_date', '');
                global counter python: 0;">

    <tal:entry tal:repeat="order python: orders['tickets']"
               tal:define="customer python: orders['customer'];">

      <tal:block
        tal:define="title python: order['cart_item_title'];
                    price python: order['cart_item_price'];
                    count python: order['cart_item_count'];
                    is_event python: order['is_event'];
                    ticket_info python: order.get('ticket_info', '');
                    footer_info python: order.get('footer_info', '');
                    to_redeem python: order['to_redeem'];
                    original_price python: order['cart_item_original_price'];
                    booking_uid python: order['booking_uid'];
                    show python: count > 0;
                    created_date python: order['order_created_date'].strftime('%d/%m/%Y');
                    ">

        <tal:count tal:repeat="item python:range(count)">

          <div class="ticket-item" style="padding-bottom: 0px;" tal:attributes="class python: 'ticket-item is_event' if is_event else 'ticket-item'">
            <div id="ticket-header" class="ticket-header">
                <img src="logos/etickets-header.jpg"/>
            </div>

            <tal:block
              tal:define="number repeat/item/number;
                          booking_uid_count python: '%s-%03d' %(str(booking_uid), number);
                          barcode_text python: to_redeem[number-1];
                          global counter python: counter + 1;">

              
              <div class="cart_item summary_item" tal:condition="show">
                <div id="ticketBarcode" class="ticket-barcode" tal:attributes="data-text barcode_text;" style="padding-top: 50px;">
              </div>
                <table>
                  <tbody>
                    <tr>
                      <td><h3 i18n:translate="type_ticket">Type ticket</h3></td><td><span tal:content="title" class="ticket-title"></span></td>
                      <td rowspan="5" class="ticket-info" tal:define="qr_code python: view.get_qr_code(booking_uid_count)" style="vertical-align: top; padding-top: 14px;">
                        <div class="info-div">
                            <tal:ticket_info tal:condition="ticket_info">
                              <p tal:content="structure python: ticket_info.output_relative_to(context.view)"></p>
                            </tal:ticket_info>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td><h3 i18n:translate="timeslot">Tijdstip</h3></td><td><span tal:content="python: timeslot_title.replace('Tijdstip', '').replace('(', '').replace(')', '')" tal:on-error="timeslot_title">Tijdstip</span></td>
                    </tr>
                    <tr tal:condition="python:is_event">
                      <td><h3 i18n:translate="date">Datum</h3></td><td><span tal:content="event_date">Date</span></td>
                    </tr>
                    <tr>
                      <td><h3 i18n:translate="client_name">Klantnaam</h3></td><td><span tal:content="customer">Customer</span></td>
                    </tr>
                    <tr>
                      <td><h3 i18n:translate="price">Prijs</h3></td><td><span tal:content="currency">EUR</span><span tal:content="price"></span></td>
                    </tr>
                    <tr>
                      <td><h3 i18n:translate="ticketnumber">Ticketnummer</h3></td>
                      <td><span tal:content="python: '%s/%s' %(counter, total_tickets)">1/2</span></td>
                    </tr>
                    <tr tal:condition="python: not is_event">
                      <td><h3 i18n:translate="purchase_date">Aankoopdatum</h3></td><td><span tal:content="created_date">07/03/2016</span></td>
                    </tr>
                  </tbody>
                </table>

                <div id="ticket-footer" class="ticket-footer">
                    <tal:event_footer_info tal:condition="python: footer_info != ''">
                       <div tal:content="structure python: footer_info.output_relative_to(context.view)"></div>
                    </tal:event_footer_info>
                </div>
                
                <div class="clearfix"></div>
              </div>
            </tal:block>

            <script>
                $(".ticket-barcode").each(function(index){
                  var text = $(this).data("text");
                  $(this).barcode(""+text, "code39", {barWidth: 1, barHeight:40, fontSize: 11});
                });
            </script>
          
          </div>
          
      </tal:count>

      </tal:block>
    </tal:entry>
  </tal:cart>
</div>
