<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bda.plone.payment">

<head>
  <metal:top fill-slot="top_slot">
    <tal:border define="dummy python:request.set('disable_border', True)" />
  </metal:top>
</head>

<body>

<metal:main fill-slot="main">
  <tal:main-macro metal:define-macro="main">

    <tal:defines define="order_data view/verify;
                      verified python:order_data.get('verified', False);
                      ordernumber python:order_data.get('ordernumber', '');
                      custom_text python: order_data.get('custom_text', '')">


      <tal:verified tal:condition="verified">
        <h1 class="documentFirstHeading"
            i18n:translate="order_received">Order Received</h1>

        <p i18n:translate="your_order_order_id" tal:condition="ordernumber">
          Your Order number:
          <span i18n:name="number" tal:replace="ordernumber">345-424-2323</span>
        </p>

        <p i18n:translate="invoice_text" tal:condition="not:custom_text">
          Thanks for your Order. You will receive the Invoice by E-Mail.
        </p>

        <p tal:condition="custom_text">
          <span tal:replace="structure custom_text"></span>
        </p>

        <a href=""
          class="payment_button standalone"
          tal:attributes="href context/absolute_url"
          i18n:translate="payment_done">Back to the shop</a>

        <!--<a href=""
          class="payment_pdf standalone"
          tal:attributes="href context/absolute_url"
          i18n:translate="payment_pdf">Download the PDF</a>-->

          <div id="order-data" style="display:none">
            <p id="order_id" tal:content="python: order_data.get('order_id', '')"></p>
            <p id="order_total" tal:content="python: order_data.get('total', '')"></p>
            <p id="order_shipping" tal:content="python: order_data.get('shipping', '')"></p>
            <p id="order_currency" tal:content="python: order_data.get('currency', '')"></p>
            <p id="order_tax" tal:content="python: order_data.get('tax', '')"></p>
            <p id="order_bookings" tal:attributes="data-bookings python:order_data.get('bookings', '')"></p>
            <p id="order_type">Product</p>
          </div>

          <tal:send_ga>
            <script type="text/javascript">
              $(document).ready(function() {
                window.dataLayer = window.dataLayer || [];
                var order_id = $('#order_id').html();
                var order_total = $('#order_total').html();
                var order_shipping = $('#order_shipping').html();
                var order_currency = $('#order_currency').html();
                var order_tax = $('#order_tax').html();
                var title = $("title").html();
                var order_type = $('#order_type').html();

                var order_bookings = $.parseJSON($('#order_bookings').attr('data-bookings'));

                dataLayer.push({
                  'event': 'transactionComplete',
                  'ecommerce': {
                    'purchase': {
                      'actionField': {
                        'id': order_id,
                        'revenue': order_total,
                        'tax': order_tax,
                        'shipping': order_shipping
                      },
                      'products': order_bookings
                    }
                  }
                });

                // Analytics 4 implementation
                dataLayer.push({ ecommerce: null });  // Clear the previous ecommerce object.
                dataLayer.push({
                  event: "purchase",
                  ecommerce: {
                      transaction_id: order_id,
                      value: order_total,
                      tax: order_tax,
                      shipping: order_shipping,
                      items: order_bookings
                  }
                });
              });
            </script>
          </tal:send_ga>

      </tal:verified>

      <tal:notverified tal:condition="not:verified">
        <h1 class="documentFirstHeading"
            i18n:translate="order_failed">Er is iets mis gegaan</h1>

        <p i18n:translate="payment_failed_email">
          De betalingsverificatie is mislukt. Probeer het nog eens of neem contact met ons op als je denkt dat de fout bij ons ligt.
        </p>
        <p><a href="mailto:info@uitgeverijkomma.nl">Neem contact op</a></p>
      </tal:notverified>

    </tal:defines>

  </tal:main-macro>
</metal:main>

</body>
</html>